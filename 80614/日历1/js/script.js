var typeInfo = [
    {
        "dateType":0,
        "info":"默认特辑",
        "itemType":[
            {
                "itemType":0,
                "info":"默认特辑-模板1",
                "bg":"img/part1/item1/bg2.jpg",
                "bg2":"img/part1/item1/bg2.jpg",
                "logo":"img/part1/item1/logo.png",
                "fontColor":"#000",
                "fontColor2":"#000",
                "fontSize":"0.18rem",
                "endFontSize":"0.35rem",
                "lineHeight":"1.02rem",
                "dateSrc":"img/part1/item1/date/",
                "border":"img/part1/item1/border.png?v=1",
                "reupload":"img/part1/item1/reupload.png",
                "left":"img/part1/item1/left.png",
                "right":"img/part1/item1/right.png",
                "btnOk":"img/part1/item1/btn-ok.png",
                "helpBtn":"img/part1/item1/help.png",
                "itemTypeBtn":"img/part1/item1/itemBtn.png?v=1",
                "endTitle":"img/part1/item1/end-title.png",
                "code":"img/part1/item1/code.png?v=1",
                "endBg":"img/part1/item1/end-bg.jpg?v=31",
                "longTap":"img/part1/item1/long-tap.png?v=1",
                "gzhBtn":"img/part1/item1/gzhBtn.png",
                "wyhBtn":"img/part1/item1/h5Btn.png",
                "imgTypeBtn":"img/part1/item1/img-type.png?v=2",
                "finger":"img/part1/item1/finger.png",
                "pageTitle":"img/part1/item1/page-title.png?v=21",
                "uploadBg":"img/part1/item1/upload-bg.png",
                "leftPx":"0.23rem",
                "fontList":[
                    "来日并不方长，我愿陪你成长",
                    "和你互道晚安，是一天里最后的甜！",
                    "在所有的道别里，我还是最喜欢明天见！",
                    "今天哭，明天笑 一身骄傲！",
                ],
                "fontList2":[
                    "宜珍惜",
                    "宜享受",
                    "宜合拍",
                    "宜炽热",
                ],
            }
        ]
    },{
        "dateType":1,
        "info":"情人节特辑",
        "itemType":[
            {
                "itemType":0,
                "info":"情人节特辑-深色模板",
                "bg":"img/part2/item1/bg2.jpg",
                "bg2":"img/part2/item1/bg2.jpg",
                "logo":"img/part2/item1/logo.png",
                "fontColor":"#dac268",
                "fontColor2":"#dac268",
                "fontSize":"0.18rem",
                "endFontSize":"0.35rem",
                "lineHeight":"1.02rem",
                "dateSrc":"img/part2/item1/date/",
                "border":"img/part2/item1/border.png?v=1",
                "reupload":"img/part2/item1/reupload.png",
                "left":"img/part2/item1/left.png",
                "right":"img/part2/item1/right.png",
                "btnOk":"img/part2/item1/btn-ok.png",
                "helpBtn":"img/part2/item1/help.png",
                "itemTypeBtn":"img/part2/item1/itemBtn.png?v=1",
                "endTitle":"img/part2/item1/end-title.png",
                "code":"img/part2/item1/code.png?v=1",
                "endBg":"img/part2/item1/end-bg.jpg?v=3",
                "longTap":"img/part2/item1/long-tap.png?v=1",
                "imgTypeBtn":"img/part1/item1/img-type.png?v=2",
                "gzhBtn":"img/part2/item1/gzhBtn.png",
                "wyhBtn":"img/part2/item1/h5Btn.png",
                "finger":"img/part2/item1/finger.png",
                "pageTitle":"img/part1/item1/page-title.png?v=211",
                "uploadBg":"img/part2/item1/upload-bg.png",
                "leftPx":"0.23rem",
                "fontList":[
					"来日并不方长，我愿陪你成长",
					"和你互道晚安，是一天里最后的甜！",
					"在所有的道别里，我还是最喜欢明天见！",
					"今天哭，明天笑 一身骄傲！",
                ],
                "fontList2":[
                   "宜珍惜",
                   "宜享受",
                   "宜合拍",
                   "宜炽热",
               ],
            },{
                "itemType":1,
                "info":"情人节特辑-粉色模板",
                "bg":"img/part2/item2/bg2.jpg",
                "bg2":"img/part2/item2/bg2.jpg",
                "logo":"img/part2/item2/logo.png",
                "fontColor":"#ffffff",
                "fontColor2":"#ffffff",
                "fontSize":"0.18rem",
                "endFontSize":"0.35rem",
                "lineHeight":"1.02rem",
                "dateSrc":"img/part2/item2/date/",
                "border":"img/part2/item2/border.png?v=1",
                "reupload":"img/part1/item1/reupload.png",
                "left":"img/part2/item2/left.png",
                "right":"img/part2/item2/right.png",
                "btnOk":"img/part2/item2/btn-ok.png",
                "helpBtn":"img/part2/item2/help.png",
                "itemTypeBtn":"img/part2/item2/itemBtn.png?v=1",
                "endTitle":"img/part2/item2/end-title.png",
                "code":"img/part2/item2/code.png?v=1",
                "endBg":"img/part2/item2/end-bg.jpg?v=3",
                "longTap":"img/part1/item1/long-tap.png?v=1",
                "imgTypeBtn":"img/part1/item1/img-type.png?v=2",
                "gzhBtn":"img/part2/item2/gzhBtn.png",
                "wyhBtn":"img/part2/item2/h5Btn.png",
                "finger":"img/part2/item2/finger.png",
                "pageTitle":"img/part1/item1/page-title.png?v=21",
                "uploadBg":"img/part2/item2/upload-bg.png",
                "leftPx":"0.23rem",
                "fontList":[
					"来日并不方长，我愿陪你成长",
					"和你互道晚安，是一天里最后的甜！",
					"在所有的道别里，我还是最喜欢明天见！",
					"今天哭，明天笑 一身骄傲！",
                ],
                "fontList2":[
                             "宜珍惜",
                             "宜享受",
                             "宜合拍",
                             "宜炽热",
                         ],
            }
        ]
    },{
        "dateType":2,
        "info":"春节特辑",
        "itemType":[
            {
                "itemType":0,
                "info":"春节特辑-红色模板",
                "bg":"img/part3/item1/bg.jpg",
                "bg2":"img/part1/item1/bg.jpg",
                "logo":"img/part2/item2/logo.png",
                "fontColor":"#ffffff",
                "fontColor2":"#ffffff",
                "fontSize":"0.18rem",
                "endFontSize":"0.35rem",
                "lineHeight":"1.02rem",
                "dateSrc":"img/part2/item2/date/",
                "border":"img/part3/item1/border.png?v=1",
                "reupload":"img/part3/item1/reupload.png",
                "left":"img/part2/item2/left.png",
                "right":"img/part2/item2/right.png",
                "btnOk":"img/part2/item2/btn-ok.png",
                "helpBtn":"img/part2/item2/help.png",
                "itemTypeBtn":"img/part2/item2/itemBtn.png?v=1",
                "endTitle":"img/part2/item2/end-title.png",
                "code":"img/part2/item2/code.png?v=1",
                "endBg":"img/part3/item1/end-bg.jpg?v=3",
                "longTap":"img/part1/item1/long-tap.png?v=1",
                "imgTypeBtn":"img/part3/item1/img-type.png?v=2",
                "gzhBtn":"img/part2/item2/gzhBtn.png",
                "wyhBtn":"img/part2/item2/h5Btn.png",
                "finger":"img/part2/item2/finger.png",
                "pageTitle":"img/part1/item1/page-title.png?v=21",
                "uploadBg":"img/part3/item1/upload-bg.png",
                "leftPx":"0.23rem",
                "fontList":[
					"来日并不方长，我愿陪你成长",
					"和你互道晚安，是一天里最后的甜！",
					"在所有的道别里，我还是最喜欢明天见！",
					"今天哭，明天笑 一身骄傲！",
                ],
                "fontList2":[
                             "宜珍惜",
                             "宜享受",
                             "宜合拍",
                             "宜炽热",
                         ],
            },{
                "itemType":1,
                "info":"春节特辑-金色模板",
                "bg":"img/part3/item2/bg2.jpg",
                "bg2":"img/part3/item2/bg2.jpg",
                "logo":"img/part1/item1/logo.png",
                "fontColor":"#000000",
                "fontColor2":"#000000",
                "fontSize":"0.18rem",
                "endFontSize":"0.35rem",
                "lineHeight":"1.02rem",
                "dateSrc":"img/part3/item2/date/",
                "border":"img/part3/item2/border.png?v=1",
                "reupload":"img/part1/item1/reupload.png",
                "left":"img/part3/item2/left.png",
                "right":"img/part3/item2/right.png",
                "btnOk":"img/part3/item2/btn-ok.png",
                "helpBtn":"img/part3/item2/help.png",
                "itemTypeBtn":"img/part3/item2/itemBtn.png?v=1",
                "endTitle":"img/part3/item2/end-title.png",
                "code":"img/part3/item2/code.png?v=1",
                "endBg":"img/part3/item2/end-bg.jpg?v=3",
                "longTap":"img/part1/item1/long-tap.png?v=1",
                "imgTypeBtn":"img/part1/item1/img-type.png?v=2",
                "gzhBtn":"img/part3/item2/gzhBtn.png",
                "wyhBtn":"img/part3/item2/h5Btn.png",
                "finger":"img/part3/item2/finger.png",
                "pageTitle":"img/part1/item1/page-title.png?v=21",
                "uploadBg":"img/part3/item2/upload-bg.png",
                "leftPx":"0.23rem",
                "fontList":[
					"来日并不方长，我愿陪你成长",
					"和你互道晚安，是一天里最后的甜！",
					"在所有的道别里，我还是最喜欢明天见！",
					"今天哭，明天笑 一身骄傲！",
                ],
                "fontList2":[
                             "宜珍惜",
                             "宜享受",
                             "宜合拍",
                             "宜炽热",
                         ],
            },{
                "itemType":2,
                "info":"春节特辑-对联模板",
                "bg":"img/part3/item3/bg.jpg",
                "bg2":"img/part1/item1/bg.jpg",
                "logo":"img/part3/item3/logo.png",
                "fontColor":"#e9cb8e",
                "fontColor2":"#e9cb8e",
                "fontSize":"0.23rem",
                "endFontSize":"0.26rem",
                "lineHeight":"1.04rem",
                "dateSrc":"img/part3/item3/date1/",
                "border":"img/part3/item3/border.png?v=1",
                "reupload":"img/part3/item3/reupload.png",
                "left":"img/part3/item3/left.png",
                "right":"img/part3/item3/right.png",
                "btnOk":"img/part3/item3/btn-ok.png",
                "helpBtn":"img/part3/item3/help.png",
                "itemTypeBtn":"img/part3/item3/itemBtn.png?v=1",
                "endTitle":"img/part3/item3/end-title.png",
                "code":"img/part3/item3/code.png?v=1",
                "endBg":"img/part3/item1/end-bg.jpg?v=3",
                "longTap":"img/part1/item1/long-tap.png?v=1",
                "imgTypeBtn":"img/part3/item1/img-type.png?v=2",
                "gzhBtn":"img/part2/item2/gzhBtn.png",
                "wyhBtn":"img/part2/item2/h5Btn.png",
                "finger":"img/part2/item2/finger.png",
                "pageTitle":"img/part1/item1/page-title.png?v=21",
                "uploadBg":"img/part3/item3/upload-bg.png",
                "leftPx":"0.73rem",
                "fontList":[
					"来日并不方长，我愿陪你成长",
					"和你互道晚安，是一天里最后的甜！",
					"在所有的道别里，我还是最喜欢明天见！",
					"今天哭，明天笑 一身骄傲！",
                ],
                "fontList2":[
                             "宜珍惜",
                             "宜享受",
                             "宜合拍",
                             "宜炽热",
                         ],
            }
        ]
    }
];

var imgs = [],imgsOther=[];
var loadingImgs = [
    "img/loading.png",
    "img/loading-hand.png"
];
if(dateType == 1){
    $(".loading-num").css("color","#e4c45d");
    $(".loading-img").css({
        "background":"url(img/loading1.png) no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    $(".loading-hand").css({
        "background":"url(img/loading-hand1.png) no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    loadingImgs = [
        "img/loading1.png",
        "img/loading-hand1.png"
    ];
}else if(dateType == 2){
    $(".loading-num").css("color","#cd2920");
    $(".loading-img").css({
        "background":"url(img/loading2.png) no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    $(".loading-hand").css({
        "background":"url(img/loading-hand2.png) no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    loadingImgs = [
        "img/loading2.png",
        "img/loading-hand2.png"
    ];
}
// 情人节
var img1 = [
    "img/part2/dog.png",
    "img/part2/heart.png",
    "img/part2/home-bg.png?v=1",
    "img/part2/home-head.png",
    "img/part2/s-bg.png",
    "img/part2/s.png",
    "img/part2/item1/bg.jpg",
    "img/part2/item1/bg2.jpg",
    "img/part2/item1/border.png?v=1",
    "img/part2/item1/btn-ok.png",
    "img/part2/item1/code.png?v=1",
    "img/part2/item1/end-bg.jpg?v=3",
    "img/part2/item1/end-title.png",
    "img/part2/item1/help.png",
    "img/part2/item1/img-type.png?v=2",
    "img/part2/item1/itemBtn.png?v=1",
    "img/part2/item1/left.png",
    "img/part2/item1/logo.png",
    "img/part2/item1/long-tap.png?v=1",
    "img/part2/item1/reupload.png",
    "img/part2/item1/right.png",
    "img/part2/item1/upload-bg.png",
    "img/part2/item1/date/1.png",
    "img/part2/item1/date/10.png",
    "img/part2/item1/date/11.png",
    "img/part2/item1/date/12.png",
    "img/part2/item1/date/13.png",
    "img/part2/item1/date/14.png",
    "img/part2/item1/date/15.png",
    "img/part2/item1/date/16.png",
    "img/part2/item1/date/17.png",
    "img/part2/item1/date/18.png",
    "img/part2/item1/date/19.png",
    "img/part2/item1/date/2.png",
    "img/part2/item1/date/20.png",
    "img/part2/item1/date/21.png",
    "img/part2/item1/date/22.png",
    "img/part2/item1/date/23.png",
    "img/part2/item1/date/24.png",
    "img/part2/item1/date/25.png",
    "img/part2/item1/date/26.png",
    "img/part2/item1/date/27.png",
    "img/part2/item1/date/28.png",
    "img/part2/item1/date/29.png",
    "img/part2/item1/date/3.png",
    "img/part2/item1/date/30.png",
    "img/part2/item1/date/31.png",
    "img/part2/item1/date/4.png",
    "img/part2/item1/date/5.png",
    "img/part2/item1/date/6.png",
    "img/part2/item1/date/7.png",
    "img/part2/item1/date/8.png",
    "img/part2/item1/date/9.png"
];

// 春节
var img2 = [
    "img/part3/home-bg.png",
    "img/part3/home-head.png",
    "img/part3/s.png",
    "img/part3/item3/code.png?v=1",
    "img/part3/item3/end-title.png",
    "img/part3/item3/bg.jpg",
    "img/part3/item3/border.png?v=1",
    "img/part3/item3/btn-ok.png",
    "img/part3/item3/help.png",
    "img/part3/item3/itemBtn.png?v=1",
    "img/part3/item3/left.png",
    "img/part3/item3/logo.png",
    "img/part3/item3/reupload.png",
    "img/part3/item3/right.png",
    "img/part3/item3/upload-bg.png",
    "img/part3/item3/page-title.png",
    "img/part3/item3/date1/1.png",
    "img/part3/item3/date1/10.png",
    "img/part3/item3/date1/11.png",
    "img/part3/item3/date1/12.png",
    "img/part3/item3/date1/13.png",
    "img/part3/item3/date1/14.png",
    "img/part3/item3/date1/15.png",
    "img/part3/item3/date1/16.png",
    "img/part3/item3/date1/17.png",
    "img/part3/item3/date1/18.png",
    "img/part3/item3/date1/19.png",
    "img/part3/item3/date1/2.png",
    "img/part3/item3/date1/20.png",
    "img/part3/item3/date1/21.png",
    "img/part3/item3/date1/22.png",
    "img/part3/item3/date1/23.png",
    "img/part3/item3/date1/24.png",
    "img/part3/item3/date1/25.png",
    "img/part3/item3/date1/26.png",
    "img/part3/item3/date1/27.png",
    "img/part3/item3/date1/28.png",
    "img/part3/item3/date1/29.png",
    "img/part3/item3/date1/3.png",
    "img/part3/item3/date1/30.png",
    "img/part3/item3/date1/31.png",
    "img/part3/item3/date1/4.png",
    "img/part3/item3/date1/5.png",
    "img/part3/item3/date1/6.png",
    "img/part3/item3/date1/7.png",
    "img/part3/item3/date1/8.png",
    "img/part3/item3/date1/9.png"
];

// 默认专题
var img3 = [
    "img/part1/finger.png",
    "img/part1/home-bg.jpg",
    "img/part1/page1-btn.png",
    "img/part1/s1page-head.png",
    "img/part1/s1Page.jpg",
    "img/part1/item1/bg.jpg",
    "img/part1/item1/bg2.jpg",
    "img/part1/item1/border.png?v=1",
    "img/part1/item1/btn-ok.png",
    "img/part1/item1/code.png?v=1",
    "img/part1/item1/end-bg.jpg?v=3",
    "img/part1/item1/end-title.png",
    "img/part1/item1/finger.png",
    "img/part1/item1/gzhBtn.png",
    "img/part1/item1/h5Btn.png",
    "img/part1/item1/help.png",
    "img/part1/item1/img-type.png?v=2",
    "img/part1/item1/itemBtn.png?v=1",
    "img/part1/item1/left.png",
    "img/part1/item1/logo.png",
    "img/part1/item1/long-tap.png?v=1",
    "img/part1/item1/page-title.png?v=21",
    "img/part1/item1/reupload.png",
    "img/part1/item1/right.png",
    "img/part1/item1/upload-bg.png",
    "img/part1/item1/date/1.png",
    "img/part1/item1/date/10.png",
    "img/part1/item1/date/11.png",
    "img/part1/item1/date/12.png",
    "img/part1/item1/date/13.png",
    "img/part1/item1/date/14.png",
    "img/part1/item1/date/15.png",
    "img/part1/item1/date/16.png",
    "img/part1/item1/date/17.png",
    "img/part1/item1/date/18.png",
    "img/part1/item1/date/19.png",
    "img/part1/item1/date/2.png",
    "img/part1/item1/date/20.png",
    "img/part1/item1/date/21.png",
    "img/part1/item1/date/22.png",
    "img/part1/item1/date/23.png",
    "img/part1/item1/date/24.png",
    "img/part1/item1/date/25.png",
    "img/part1/item1/date/26.png",
    "img/part1/item1/date/27.png",
    "img/part1/item1/date/28.png",
    "img/part1/item1/date/29.png",
    "img/part1/item1/date/3.png",
    "img/part1/item1/date/30.png",
    "img/part1/item1/date/31.png",
    "img/part1/item1/date/4.png",
    "img/part1/item1/date/5.png",
    "img/part1/item1/date/6.png",
    "img/part1/item1/date/7.png",
    "img/part1/item1/date/8.png",
    "img/part1/item1/date/9.png",
];

// 其他图片
var imgsEnd = [
    "img/type-btn.png",
    "img/part2/item2/bg.jpg",
    "img/part2/item2/btn-ok.png",
    "img/part2/item2/code.png?v=1",
    "img/part2/item2/end-bg.jpg?v=3",
    "img/part2/item2/end-title.png",
    "img/part2/item2/finger.png",
    "img/part2/item2/gzhBtn.png",
    "img/part2/item2/h5Btn.png",
    "img/part2/item2/help.png",
    "img/part2/item2/itemBtn.png?v=1",
    "img/part2/item2/left.png",
    "img/part2/item2/logo.png",
    "img/part2/item2/page-title.png?v=2",
    "img/part2/item2/right.png",
    "img/part2/item2/upload-bg.png",

    "img/part3/item1/bg.jpg",
    "img/part3/item1/border.png?v=1",
    "img/part3/item1/end-bg.jpg?v=3",
    "img/part3/item1/img-type.png?v=2",
    "img/part3/item1/reupload.png",
    "img/part3/item1/upload-bg.png",
    "img/part3/item2/bg.jpg",
    "img/part3/item2/border.png?v=1",
    "img/part3/item2/btn-ok.png",
    "img/part3/item2/code.png?v=1",
    "img/part3/item2/end-bg.jpg?v=3",
    "img/part3/item2/end-title.png",
    "img/part3/item2/finger.png",
    "img/part3/item2/gzhBtn.png",
    "img/part3/item2/h5Btn.png",
    "img/part3/item2/help.png",
    "img/part3/item2/img-type.png?v=2",
    "img/part3/item2/itemBtn.png?v=1",
    "img/part3/item2/left.png",
    "img/part3/item2/right.png",
    "img/part3/item2/upload-bg.png",
    "img/part3/item2/date/1.png",
    "img/part3/item2/date/10.png",
    "img/part3/item2/date/11.png",
    "img/part3/item2/date/12.png",
    "img/part3/item2/date/13.png",
    "img/part3/item2/date/14.png",
    "img/part3/item2/date/15.png",
    "img/part3/item2/date/16.png",
    "img/part3/item2/date/17.png",
    "img/part3/item2/date/18.png",
    "img/part3/item2/date/19.png",
    "img/part3/item2/date/2.png",
    "img/part3/item2/date/20.png",
    "img/part3/item2/date/21.png",
    "img/part3/item2/date/22.png",
    "img/part3/item2/date/23.png",
    "img/part3/item2/date/24.png",
    "img/part3/item2/date/25.png",
    "img/part3/item2/date/26.png",
    "img/part3/item2/date/27.png",
    "img/part3/item2/date/28.png",
    "img/part3/item2/date/29.png",
    "img/part3/item2/date/3.png",
    "img/part3/item2/date/30.png",
    "img/part3/item2/date/31.png",
    "img/part3/item2/date/4.png",
    "img/part3/item2/date/5.png",
    "img/part3/item2/date/6.png",
    "img/part3/item2/date/7.png",
    "img/part3/item2/date/8.png",
    "img/part3/item2/date/9.png"
];

if(dateType == 1){
    imgs = imgs.concat(img1);
    imgsOther = imgsOther.concat(img2,img3,imgsEnd);
}else if(dateType == 2){
    imgs = imgs.concat(img2);
    imgsOther = imgsOther.concat(img1,img3,imgsEnd);
}else{
    imgs = imgs.concat(img3);
    imgsOther = imgsOther.concat(img1,img2,imgsEnd);
}

var shareData= {
    MsgImg:'http://go.163.com/2018/0101/taidu-upload/img/share.png',  //分享图片
    link:'http://go.163.com/2018/0101/taidu-upload/index.html',    //分享链接
    title:'留下我的印记，写入态度日历',   //分享标题
    desc:'在这世界留下你的印记，写入我的 态度日历。',    //分享描述
    fText:'留下我的印记，写入态度日历',    //分享朋友圈
    callback:function(){
        share_survey(true);
    }
};
if(dateType == 1){
    // 情人节
    shareData.title = "爱情的巨轮说沉就沉，单身狗的小船屹立不倒。";
    shareData.desc = "点击生成你的专属日历";
    shareData.fText = "爱情的巨轮说沉就沉，单身狗的小船屹立不倒。";
}else if(dateType == 2){
    // 春节
    shareData.title = "2018你更懂世界，态度日历更懂你。";
    shareData.desc = "点击生成你的专属日历";
    shareData.fText = "2018你更懂世界，态度日历更懂你。";
}

var urlHost,imgBase1,imgBase2,imgBase3,imgBase4,imgBase5,lunar,fontIndex = randomNum(0,typeInfo[dateType].itemType[itemType].fontList.length-1),fontIndex2 = 0,uploadLock = false,itemBtnFlag = true;

$(document).bind("touchmove",function(e){
    e.preventDefault();
});
$(function(){
    setHTTP();
    setTimeout(function(){
        loadingFn(imgs,function(){
            init();
        });
    },2000);
    shareFn();
});

function init(){
    h();
    e();
    s();
    i();
}

function h(){
    // 首页初始化
    $(".page1-item").css("display","none").eq(dateType).css("display","block");

    // 模板切换
    itemChange();

    loadingAfter(imgsOther,function(){
        // alert(imgsOther.length);
    });
}

function e() {
    // 开启首页
    $(".page1").on("click",function(){
        $(".page1-item").eq(dateType).addClass("ani");
        if(dateType == 0){
            // 点击后动画
            $(".page1-item1.ani .page1-btn")[0].addEventListener("webkitAnimationEnd", function(){ //动画结束时事件
                $(".page1").fadeOut(500,function(){
                    $(".page1-item1").removeClass("ani");
                });
            }, false);
        }
        if(dateType == 1){
            $(".page1-item2.ani .si-page2")[0].addEventListener("webkitAnimationEnd", function(){ //动画结束时事件
                $(".page1").fadeOut(500,function(){
                    $(".page1-item2").removeClass("ani");
                });
            }, false);
        }
        if(dateType == 2){
            $(".page1-item3.ani .si-page3")[0].addEventListener("webkitAnimationEnd", function(){ //动画结束时事件
                $(".page1").fadeOut(500,function(){
                    $(".page1-item3").removeClass("ani");
                });
            }, false);
        }
    });

    // 获取当前日期
    dateChange(yearNum,monthNum,dayNum);

    // 日期选择
    $(".date-now").on("change",function(){
        yearNum = $(this).val().split("-")[0];
        monthNum = $(this).val().split("-")[1];
        // console.log(monthNum);
        dayNum = $(this).val().split("-")[2];
        if(yearNum>0){
            if(yearNum > 2100 || yearNum < 1900){
                alert("目前仅支持选择1900年~2100年之间的日期");
            }else{
                dateChange(yearNum,monthNum,dayNum);
            }
        }
    });

    // 提示消失
    $(".page2-title").on("touchstart",function(){
        $(this).fadeOut(400);
    });
    $(".titleBtn").on("click",function(){
        $(".page2-title").fadeIn(400);
    });

    // 图片上传
    if(netease.ua.android){
        $('.upload').attr({"accept":"image/*"});
    }
    $("#canvas")[0].width = $(".img-edit").width();
    $("#canvas")[0].height = $(".img-edit").height();
    imgUpload();

    // 滤镜切换
    $(".img-type-item").on("click",function(){
        var index = $(this).index();
        imgType = index;
        imgTypeChange();
    });

    // 模板按钮
    $(".item-btn").on("click",function(){
        if(itemBtnFlag){
            $(".item-type-box").fadeOut(400);
            $(".btn-ok").fadeIn(400);
            itemBtnFlag = !itemBtnFlag;
        }else{
            $(".item-type-box").fadeIn(400);
            $(".btn-ok").fadeOut(400);
            itemBtnFlag = !itemBtnFlag;
        }
    });

    if(dateType == 0){
        // 基础版
        $(".item-type-item").removeClass("ac").eq(5).addClass("ac");
    }else if(dateType == 1){
        // 深色
        $(".item-type-item").removeClass("ac").eq(0).addClass("ac");
    }else if(dateType == 2){
        // 红色
        $(".item-type-item").removeClass("ac").eq(3).addClass("ac");
    }

    // 按钮切换 深色-金色-粉色-红色-新加版本-基础版
    $(".item-type-item").on("click",function(){
        var index = $(this).index();
        switch (index){
            // 深色
            case 0: dateType = 1; itemType = 0; itemChange(); break;
            // 金色
            case 1: dateType = 2; itemType = 1; itemChange(); break;
            // 粉色
            case 2: dateType = 1; itemType = 1; itemChange(); break;
            // 基础版
            case 3: dateType = 0; itemType = 0; itemChange(); break;
        }
        dateChange(yearNum,monthNum,dayNum);
        sf.update();
        fontIndex = $(".sf .swiper-slide-active").data("index");
        sf.slideTo(0,100);
        $(".item-type-item").removeClass("ac").eq(index).addClass("ac");
        $(".item-type-box").fadeOut(400);
        $(".btn-ok").fadeIn(400);
        itemBtnFlag = !itemBtnFlag;
    });

    // 生成最终图片
    $(".btn-ok").on("click",function(){
        if(!$(".swiper-slide-active .customFont").val() && (fontIndex ==typeInfo[dateType].itemType[itemType].fontList.length)){
            alert("请输入自定义文字");
            return;
        }
        if((fontIndex ==typeInfo[dateType].itemType[itemType].fontList.length) && screenStr($(".swiper-slide-active .customFont").val())){
            alert("请换一句话试试");
            return;
        }
        if(uploadLock){
            $(".img-loading").html("正在生成...").fadeIn(300);
            $(".page3").fadeIn();
            imgEnd();
        }else{
            alert("请上传照片");
        }
        shareData.desc = typeInfo[dateType].itemType[itemType].fontList[fontIndex];
      
    });

    // 长按提示
    $(".pagelongtap").on("touchstart",function(){
        $(".pagelongtap").fadeOut(300);
    });

    // 公众号
    $(".gzhBtn").on("click",function(){
        setTimeout(function(){
            window.location.reload();
        },50);
    });
    // 网易号
    $(".h5Btn").on("click",function(){
        setTimeout(function(){
            window.location.href="https://c.m.163.com/news/sub/T1514445150153.html?spss=newsapp&spssid=6e93b1fdeafbde0371d53d909b9d16c3&spsw=1";
        },50);
    });
}

function s(){
    sf = new Swiper(".sf",{
        loop: true,
        onInit:function(sf){
            fontIndex = randomNum(0,7);
            // console.log(fontIndex);
            sf.slideTo(fontIndex+1);
        },
        onSlideChangeEnd:function(sf){
            fontIndex = $(".sf .swiper-slide-active").data("index");

        },
        prevButton:'#left',
        nextButton:'#right'
    });
    
    sw = new Swiper(".sw",{
        loop: true,
        onSlideChangeEnd:function(sf){
            fontIndex2 = $(".sw .swiper-slide-active").data("index");
        },
        prevButton:'#wleft',
        nextButton:'#wright'
    });
}

function i(){
    // 高度自适应
    resizeRem();
    $(window).on('resize', resizeRem);
}

function itemChange(){
    // 背景
    $(".page2").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].bg +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 图片背景
    $(".endImg-wrap").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].bg +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 提示弹层
    $(".page2-title").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].pageTitle +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // end页背景
    $(".page3").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].bg2 +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 左上角logo
    $(".page2-logo").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].logo +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 边框
    $(".page_border").attr('src',typeInfo[dateType].itemType[itemType].border);
    // 上传背景
    $(".upload-img-wrap").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].uploadBg +") no-repeat",
        "-webkit-background-size":"0.54rem 0.58rem",
        "background-size":"0.54rem 0.58rem",
        " background-position":" center center"
    });
    // 重新上传
    $(".reUpload").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].reupload +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 左右按钮
    $("#left").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].left +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover",
        "left":typeInfo[dateType].itemType[itemType].leftPx
    });
    $("#right").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].right +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover",
        "right":typeInfo[dateType].itemType[itemType].leftPx
    });
    // 完成按钮
    $(".btn-ok").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].btnOk +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 帮助按钮
    $(".titleBtn").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].helpBtn +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 模板按钮
    $(".item-btn").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].itemTypeBtn +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 滤镜按钮
    $(".img-type").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].imgTypeBtn +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 长按保存
    $(".longtap-img").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].longTap +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 公众号按钮
    $(".gzhBtn").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].gzhBtn +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 网易号按钮
    $(".h5Btn").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].wyhBtn +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 手
    $(".page3-finger").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].finger +") no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    // 文字生成
    $(".sf .swiper-wrapper").empty();
    for(var i = 0;i < typeInfo[dateType].itemType[itemType].fontList.length+1; i++){
        if(i < typeInfo[dateType].itemType[itemType].fontList.length){
            var str = '<div data-index="'+i+'" class="swiper-slide sfd sfd'+i+'"><span>'+ typeInfo[dateType].itemType[itemType].fontList[i] +'</span></div>';
        }else{
            var str = '<div data-index="'+i+'" class="swiper-slide sfd sfd'+i+'">' +
                '<span style="opacity: 0"></span><input type="text" id="customFont" class="customFont" placeholder="请输入自定义文字" maxlength="15">' +
                '</div>';
        }
        $(".sf .swiper-wrapper").append(str);
    }
    $(".sw .swiper-wrapper").empty();
    for(var i = 0;i < typeInfo[dateType].itemType[itemType].fontList2.length+1; i++){
        if(i < typeInfo[dateType].itemType[itemType].fontList2.length){
            var str = '<div data-index="'+i+'" class="swiper-slide swd swd'+i+'"><span>'+ typeInfo[dateType].itemType[itemType].fontList2[i] +'</span></div>';
        }else{
            var str = '<div data-index="'+i+'" class="swiper-slide swd swd'+i+'">' +
                '<span style="opacity: 0"></span><input type="text" id="customFont" class="customFont" placeholder="请输入自定义文字" maxlength="5">' +
                '</div>';
        }
        $(".sw .swiper-wrapper").append(str);
    }
    // 文字颜色
    $(".date-nong,.date-yang-year,.sfd,.customFont,.words_sel").css("color",typeInfo[dateType].itemType[itemType].fontColor);
    $(".week").css("color",typeInfo[dateType].itemType[itemType].fontColor2);
    // 文字大小
    $(".sfd").css({
        "font-size":typeInfo[dateType].itemType[itemType].fontSize,
        "line-height":typeInfo[dateType].itemType[itemType].lineHeight
    });
    $(".swd").css({
        "font-size":"0.34rem",
        "line-height":typeInfo[dateType].itemType[itemType].lineHeight
    });
    $(".sfd .customFont").css({
        "font-size":typeInfo[dateType].itemType[itemType].fontSize,
        "line-height":typeInfo[dateType].itemType[itemType].lineHeight
    });
    $(".swd .customFont").css({
        "font-size":"0.34rem",
        "line-height":typeInfo[dateType].itemType[itemType].lineHeight
    });

}
var ARR_MONTH = [['JAN','一月'],['FEB','二月'],['MAR','三月'],['APRIL','四月'],['MAY','五月'],['JUNE','六月'],['JULY','七月'],['AUG','八月'],['SEP','九月'],['OCT','十月'],['NOV','十一月'],['DEC','十二月']];
function dateChange(year,month,day) {
    $(".date-yang-day").css({
        "background":"url("+ typeInfo[dateType].itemType[itemType].dateSrc+(+day)+".png) no-repeat",
        "-webkit-background-size":"cover",
        "background-size":"cover"
    });
    $(".date-yang-year span").html(year);
    $(".date-nong span").eq(0).html(ARR_MONTH[parseInt(month)-1][0]);
    $(".date-nong span").eq(1).html(ARR_MONTH[parseInt(month)-1][1]);
    lunar = calendar.solar2lunar(year,month,day);
    switch (lunar.nWeek){
        case 1: $(".week span").eq(0).html("MON");$(".week span").eq(1).html("星期一"); break;
        case 2: $(".week span").eq(0).html("TUES");$(".week span").eq(1).html("星期二"); break;
        case 3: $(".week span").eq(0).html("WED");$(".week span").eq(1).html("星期三"); break;
        case 4: $(".week span").eq(0).html("THURS");$(".week span").eq(1).html("星期四"); break;
        case 5: $(".week span").eq(0).html("FRI");$(".week span").eq(1).html("星期五"); break;
        case 6: $(".week span").eq(0).html("SAT");$(".week span").eq(1).html("星期六");break;
        case 7: $(".week span").eq(0).html("SUN");$(".week span").eq(1).html("星期日"); break;
    }
}

// 图片上传
function imgUpload(){
    // 图片编辑组件初始化
    imgeditor = new ImgEditor({
        el: document.getElementById('canvas'),
        color: 'transparent'
    });

    gesture = new Gesturer({
        el: document.getElementById('canvas'),
        onPressMove: function (evt) {
            imgeditor.onMove(evt);
        },
        onPinch: function (evt) {
            imgeditor.onPinch(evt);
        },
        onRotate: function (evt) {
            imgeditor.onRotate(evt);
        }
    });
    gesture.on();  // 开启手势事件

    // 安卓新闻客户端适配
    if(netease.ua.newsapp&&netease.ua.android){
        $('.upload').click(function(){
            window.location='uploadimage://camera/1020_1240';
            $(".img-loading").fadeIn();
            $(".reUpload").fadeIn();
            uploadLock = true;
        });
    }else{
        $('.upload').on('change',function (){
            var file = this.files[0];
            if(!/image\/\w+/.test(file.type)){
                alert("请上传图片");
                return false;
            }
            uploadLock = true;
            $(".img-loading").fadeIn();
            $(".reUpload").fadeIn();
            lrz(file,{
                width: 640,
                quality:0.8,
                done: function (results) {
                    var base64 = results.base64;
                    getData(base64,36);
                }
            });
        });
    }
}

// 安卓下NewsApp的上传图片成功回调 （需要放在全局）
function __newsapp_upload_image_done(url){
    var img = new Image();
    img.src = url+'?cors';
    img.crossOrigin = 'anonymous';

    var c=document.createElement("canvas");
    c.width=1000;
    c.height=1400;
    var cxt=c.getContext("2d");
    img.onload = function(){
        // 照片
        cxt.drawImage(img,0,0);
        var base64 = c.toDataURL('image/jpeg',0.6);
        getData(base64,36);
    };
}
function setHTTP(){
    var _url = window.location.href;
    if(_url.search(/https/)==0){
        // https
        if(location.href.indexOf('test.go.163') > -1){//测试地址
            urlHost = location.href.indexOf('auto')>-1?"https://test.go.163.com/api/auto":"https://test.go.163.com/api/go";
        }else{//正式地址
            urlHost = location.href.indexOf('s.auto.163')>-1?"https://s.auto.163.com/api":"https://go.163.com/api";
        }
    }else{
        // 判断接口地址
        if(location.href.indexOf('test.go.163') > -1){//测试地址
            urlHost = location.href.indexOf('auto')>-1?"http://test.go.163.com/api/auto":"http://test.go.163.com/api/go";
        }else{//正式地址
            urlHost = location.href.indexOf('s.auto.163')>-1?"http://s.auto.163.com/api":"http://go.163.com/api";
        }
    }
}

function getData(base64,filter){
    // 天天P图：/2018/0115/ptu_imgfilter/common.php
    // AL Lab:/2018/0115/ptu_imgfilter/common.php
    // 4原图
    imgBase5 = base64;
    // 0清新
    $.ajax({
        type:"post",
        
        url: "./api/ptu_imgfilter.php",
        data:{
            pic:base64,
            filter:32
        },
        success:function(data1){
			var data =  JSON.parse(data1);
            lockFlag = false;
            if(data.ret==0){
                imgBase1 = "data:image/jpeg;base64,"+data.data.image;
                imgTypeChange();
                $(".upload-img-wrap").fadeOut(500);
                $(".img-loading").fadeOut(500);
                $(".item-type-box").fadeOut(400);
                $(".btn-ok").fadeIn(400);
                itemBtnFlag = !itemBtnFlag;
            }else{
                //alert(data.msg);
            }
        }
    });
    // 1暖阳
    $.ajax({
        type:"post",
        
        url: "./api/ptu_imgfilter.php",
        data:{
            pic:base64,
            filter:5
        },
        success:function(data1){
			var data =  JSON.parse(data1);
            lockFlag = false;
            if(data.ret==0){
                // console.log(data);
                imgBase2 = "data:image/jpeg;base64,"+data.data.image;
            }else{
                //alert(data.msg);
            }
        }
    });
    // 2彩虹
    $.ajax({
        type:"post",
        
        url: "./api/ptu_imgfilter.php",
        data:{
            pic:base64,
            filter:1
        },
        success:function(data1){
			var data =  JSON.parse(data1);
            lockFlag = false;
            if(data.ret==0){
                imgBase3 = "data:image/jpeg;base64,"+data.data.image;
            }else{
                //alert(data.msg);
            }
        }
    });
    // 3经典
    $.ajax({
        type:"post",
        
        url: "./api/ptu_imgfilter.php",
        data:{
            pic:base64,
            filter:5
        },
        success:function(data1){
			var data =  JSON.parse(data1);
            lockFlag = false;
            if(data.ret==0){
                imgBase4 = "data:image/jpeg;base64,"+data.data.image;
            }else{
                //alert(data.msg);
            }
        }
    });
}

// 切换滤镜
function imgTypeChange(){
    switch (imgType){
        case 0:imgeditor.setImg(imgBase1);break;
        case 1:imgeditor.setImg(imgBase2);break;
        case 2:imgeditor.setImg(imgBase3);break;
        case 3:imgeditor.setImg(imgBase4);break;
        case 4:imgeditor.setImg(imgBase5);break;
    }
}
var pxScaleNum = 640/$(window).width();
// 生成最终图片
function imgEnd() {
    var c=document.createElement("canvas");
    c.width=640;
    c.height=1236;
    var ctx=c.getContext("2d");

        // 星期
        ctx.textBaseline="top";
        ctx.fillStyle = typeInfo[dateType].itemType[itemType].fontColor;
        ctx.font = ""+ $(".week").css("font-size").split("px")[0]*pxScaleNum+"px" +" 'm'";
        var wleft = $(".week")[0].offsetLeft*pxScaleNum;
        var wtop = $(".week")[0].offsetTop*pxScaleNum;
        ctx.fillText($(".week span").eq(0).html(),wleft+$(".week span")[0].offsetLeft*pxScaleNum,wtop+$(".week span")[0].offsetTop*pxScaleNum-5);
        ctx.fillText($(".week span").eq(1).html(),wleft+$(".week span")[1].offsetLeft*pxScaleNum,wtop+$(".week span")[1].offsetTop*pxScaleNum-5);
        
        // 日期
        ctx.fillStyle = typeInfo[dateType].itemType[itemType].fontColor;
        ctx.font = ""+ $(".date-nong").css("font-size").split("px")[0]*pxScaleNum+"px" +" 'm'";
        
        var dleft = $(".date-nong")[0].offsetLeft*pxScaleNum;
        var dtop = $(".date-nong")[0].offsetTop*pxScaleNum;
        ctx.fillText($(".date-nong span").eq(0).html(),dleft+$(".date-nong span")[0].offsetLeft*pxScaleNum,dtop+$(".date-nong span")[0].offsetTop*pxScaleNum-2);
        ctx.fillText($(".date-nong span").eq(1).html(),dleft+$(".date-nong span")[1].offsetLeft*pxScaleNum,dtop+$(".date-nong span")[1].offsetTop*pxScaleNum-2);

        // 图片
        var img = new Image();
        img.src = imgeditor.getImg();
        img.onload = function(){
        	
        	var yleft = $(".date-yang-year")[0].offsetLeft*pxScaleNum;
        	
            // 照片
            ctx.drawImage(img,yleft,$(".upload-wrap")[0].offsetTop*pxScaleNum+$(".upload-box")[0].offsetTop*pxScaleNum,$("#canvas").width()*pxScaleNum ,$("#canvas").height()*pxScaleNum);
            // console.log("照片绘制成功");


                // 阳历 日
                var imgDateDay = new Image();
                imgDateDay.src = typeInfo[dateType].itemType[itemType].dateSrc+(+dayNum)+".png";
                imgDateDay.onload = function(){
                    ctx.drawImage(imgDateDay,$(".date-yang-day")[0].offsetLeft*pxScaleNum-21.8,$(".date-yang-day")[0].offsetTop*pxScaleNum-32);
                    // console.log("阳历日绘制成功");
                    // 阳历 年
                    ctx.textBaseline="top";
                    ctx.fillStyle = typeInfo[dateType].itemType[itemType].fontColor;
                    ctx.font = ""+$(".date-yang-year").css("font-size").split("px")[0]*pxScaleNum+"px"+" 'm'";
                    
                    var ytop = $(".date-yang-year")[0].offsetTop*pxScaleNum;
                    ctx.fillText($(".date-yang-year span").html(),yleft+$(".date-yang-year span")[0].offsetLeft*pxScaleNum,ytop+$(".date-yang-year span")[0].offsetTop*pxScaleNum-10);
                    ctx.font = ""+$(".date-yang-year label").css("font-size").split("px")[0]*pxScaleNum+"px"+" 'm'";
                    ctx.fillText($(".date-yang-year label").html(),yleft+$(".date-yang-year label")[0].offsetLeft*pxScaleNum,ytop+$(".date-yang-year label")[0].offsetTop*pxScaleNum-10);
                    
                    var stop = $(".words_sel")[0].offsetTop;
//                    ctx.font = ""+$(".words_sel").css("font-size").split("px")[0]*pxScaleNum+"px"+" 'm'";
//                    ctx.fillText($(".words_sel span").html(),$(".words_sel")[0].offsetLeft*pxScaleNum,$(".words_sel")[0].offsetTop*pxScaleNum-10);

                    // 文字
                    ctx.font ="13px" +" 'SimSun'";
                    if(fontIndex ==typeInfo[dateType].itemType[itemType].fontList.length ){
                        ctx.fillText($(".sf .swiper-slide-active .customFont").val(),dleft,stop+80);
                    }else{
                        ctx.fillText(typeInfo[dateType].itemType[itemType].fontList[fontIndex],dleft,stop+80);
                    }
                    ctx.font ="34px" +" 'SimSun'";
                    if(fontIndex2 ==typeInfo[dateType].itemType[itemType].fontList2.length ){
                    	$(".swd"+fontIndex2+" span").html($(".sw .swiper-slide-active .customFont").val());
                        ctx.fillText($(".sw .swiper-slide-active .customFont").val(),($(".main").width()-$(".swd"+fontIndex2+" span").width())/2*pxScaleNum,$(".words_sel")[0].offsetTop*pxScaleNum+15);
                    }else{
                        ctx.fillText(typeInfo[dateType].itemType[itemType].fontList2[fontIndex2],($(".main").width()-$(".swd"+fontIndex2+" span").width())/2*pxScaleNum,$(".words_sel")[0].offsetTop*pxScaleNum+15);
                    }


                        // 二维码
                        var imgEq = new Image();
                        imgEq.src = typeInfo[dateType].itemType[itemType].code;
                        imgEq.onload = function(){
                            ctx.drawImage(imgEq,wleft,wtop+80);
                            var endImgBase64 = c.toDataURL('image/png',0.9);

                            // 裁剪图片
                            var c2=document.createElement("canvas");
                            c2.width=640;
                            c2.height=680;
                            var ctx2=c2.getContext("2d");
                                
                            //背景图
                            var endbg = new Image();
                            endbg.src = typeInfo[dateType].itemType[itemType].endBg;
                            endbg.onload = function(){
                                ctx2.drawImage(endbg,0,0);
                                
                                var endImg2 = new Image();
                                endImg2.src=endImgBase64;
                                endImg2.onload = function(){
                                    ctx2.drawImage(endImg2,0,278,640,680,0,0,640,680);
                                    
                                    $(".endImg2").attr("src",c2.toDataURL('image/png',0.9)).show();
                                    $(".page2-content").fadeOut(100);
                                    $(".img-result-wrap").fadeIn(50);
                                    
                                    $(".img-loading").fadeOut(400,function(){
                                        $(".page2").addClass("ani");
                                        // 检测动画完成
                                        $(".page2.ani")[0].addEventListener("webkitAnimationEnd", function(){ //动画结束时事件
                                            $(".pagelongtap").fadeIn(400);
                                        }, false);
                                    });
                                }
                                
                            };
                    }
                }
        }
}

function loadingBefore(imgs,callback){
    if(!imgs){return false};
    var img=[];
    var len=imgs.length;
    var loadedCount = 0;
    for(var i=0;i<len;i++){
        img[i]=new Image();
        img[i].src=imgs[i];
        img[i].onload = function(){
            loadedCount++;
            if (loadedCount>=len){
                callback ? callback() : null;
            }
        };
    }
}

function loadingFn(imgs,callback){
    if(!imgs){return false};
    var img=[];
    var len=imgs.length;
    var loadedCount = 0;
    for(var i=0;i<len;i++){
        img[i]=new Image();
        img[i].src=imgs[i];
        img[i].onload = function(){
            loadedCount++;
            $('.loading-num').html(Math.floor(loadedCount/len*100)+"%").attr('title',Math.floor(loadedCount/len*100));
            if (loadedCount>=len){
                setTimeout(function(){
                    $('.loading-wrap').fadeOut(600,function(){
                        $(this).remove();
                    });
                },50);
                callback ? callback() : null;
            }
        };
    }
};

function loadingAfter(imgs,callback){
    if(!imgs){return false};
    var img=[];
    var len=imgs.length;
    var loadedCount = 0;
    for(var i=0;i<len;i++){
        img[i]=new Image();
        img[i].src=imgs[i];
        img[i].onload = function(){
            loadedCount++;
            if (loadedCount>=len){
                callback ? callback() : null;
            }
        };
    }
}

// 高度自适应
function resizeRem() {
    var hh = 640 / $(window).width() * $(window).height();
    if(hh < 1000) {
        $('.scale').css({
            '-webkit-transform': 'scale(0.9)'
        });
    }

    if(hh < 900) {
        $('.scale').css({
            '-webkit-transform': 'scale(0.8)'
        });
    }
}

function shareFn(){
    NeteaseShareInit();
    // document.getElementById("shareBtn").onclick = function() {
    //     NeteaseShare(function(){
    // 微信分享提示
    // $(".share-wrap").fadeIn(500);
    // },false);
    // }
}

// 13.0 获取随机数
function randomNum(min,max){
    return Math.floor(Math.random() * (max - min + 1)) + min;
}